//Imports
import bcHomePage from '../pageObjects/bcHomePage'

//Test suite for BetterCloud navigationg from homepage
describe('Navigate to BetterCloud Homepage', () => {
    const l = new bcHomePage()
    //Test cases based on requirements
    it('Should locate and click on "Company" in navigation bar', () => {
        l.bcHomePage()
        l.bcCompanyLink().should('have.text', 'Company')
        l.bcCompanyLink().click()      
    })
    it('Should check if "About BetterCloud" is visible as H1', () =>{
        cy.get('h1').invoke('text').should('eq', 'About BetterCloud');
    })
    it('Should locate and click the "Board" tab in navigation bar', () => {
        l.bcBoardLink().click()
    })
    //Test suite for scraping data
    describe('Webscrape "Board" page', () => {
        beforeEach(function () {
            l.bcBoardMemberPage
        })
        //Test case to scrap and log data
        it('Scrape Data', function (){
           cy.get('.board-tab').each(function($row, index, $rows){

            cy.wrap($row).within(function(){
                cy.get('.board-members[data-v-6ff01ff0]').each(function($cellData, index, $columns){
                    cy.log($cellData.text())
                })

            })
           }) 
        })
        
        //Test case to capture data, create CSV file, and save CSV file
         it('Should write to csv file', function() {
            l.bcBoardMemberPage
            cy.request('https://www.bettercloud.com/company/#board')
                .then((Response) => {
                    //Create CSV file data in array
                    var csvFileData = [
                        ['JON HALLET', 'Jon Hallett is the Executive Chairman of BetterCloud. Jonâ€™s investment firm, Hallett Capital, led BetterClouds first round of company funding. '],
                        ['DAVID POLITIS', 'David Politis is the founder and CEO of BetterCloud. He oversees the day-to-day activities of the company and the overall production  vision and business strategy.'],
                        ['ENRIQUE SALEM', 'Enrique Salem joined Bain Capital Ventures in 2014, where he focuses on infrastructure software and services. Previously, he was CEO of Symantec(Nasdaq:SYMC).'],
                        ['ARUN MATHEW', 'Arun Mathew joined Accel in 2009 and leads growth investments in the enterprise, security, and infrastructure markets.'],
                        ['BRIAN CHANG', 'Brian Chang is Managing Director at Warburg Pincus and focuses on investments in the technology, software, and financial technology sectors.']
                    ];
                    ///Define header for each row
                    var csv = 'Name, Excerpt\n';
                    
                    //Merge the data with csv
                    csvFileData.forEach(function(row) {
                        csv += row.join(',');
                        csv += "\n"
                    });
                    
                    //Display the created CSV data on web browser and save it to local directory
                    document.write(csv);
                    cy.writeFile('cypress/fixtures/export.csv', csv)

                    var hiddenElement = document.createElement('a');
                    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
                    hiddenElement.target = '_blank';

                    //provide the name for he CSV file to be downloaded
                    hiddenElement.download = 'export.csv';
                    
                })
            })      
    })
})
